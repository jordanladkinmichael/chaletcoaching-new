# –°–≤–æ–¥–∫–∞ —É–ª—É—á—à–µ–Ω–∏–π –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ PDF

## ‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ —ç—Ç–∞–ø—ã

### –≠—Ç–∞–ø 1: –ú–∏–≥—Ä–∞—Ü–∏—è –Ω–∞ Vercel Blob Storage ‚úÖ
- –°–æ–∑–¥–∞–Ω–∞ —É—Ç–∏–ª–∏—Ç–∞ `lib/blob-storage.ts` –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å Vercel Blob
- PDF —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ Vercel Blob –≤–º–µ—Å—Ç–æ base64 –≤ –ë–î
- –í –ë–î —Ö—Ä–∞–Ω–∏—Ç—Å—è —Ç–æ–ª—å–∫–æ URL
- –û–±–Ω–æ–≤–ª–µ–Ω —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥ –¥–ª—è –ø–æ–¥–¥–µ—Ä–∂–∫–∏ –Ω–æ–≤—ã—Ö URL

**–§–∞–π–ª—ã:**
- `lib/blob-storage.ts` (–Ω–æ–≤—ã–π)
- `inngest/functions/pdf-generation.ts` (–æ–±–Ω–æ–≤–ª–µ–Ω)
- `app/page.tsx` (–æ–±–Ω–æ–≤–ª–µ–Ω)
- `env.example` (–æ–±–Ω–æ–≤–ª–µ–Ω)

---

### –≠—Ç–∞–ø 2: –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –∫–æ–Ω—Ç–µ–Ω—Ç–∞ —á–µ—Ä–µ–∑ OpenAI ‚úÖ
- –°–æ–∑–¥–∞–Ω–∞ —É—Ç–∏–ª–∏—Ç–∞ `lib/pdf-formatter.ts` –¥–ª—è —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∫–æ–Ω—Ç–µ–Ω—Ç–∞
- –ü—Ä–æ–º–ø—Ç –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω –¥–ª—è –∫–æ–º–ø–∞–∫—Ç–Ω–æ–≥–æ PDF (–º–∞–∫—Å–∏–º—É–º 4 —Å—Ç—Ä–∞–Ω–∏—Ü—ã)
- –ò—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è —Ç–∞–±–ª–∏—Ü—ã –∏ —Å–ø–∏—Å–∫–∏ –≤–º–µ—Å—Ç–æ –¥–ª–∏–Ω–Ω—ã—Ö —Ç–µ–∫—Å—Ç–æ–≤
- –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω `nutritionAdvice` –≤ PDF

**–§–∞–π–ª—ã:**
- `lib/pdf-formatter.ts` (–Ω–æ–≤—ã–π)
- `lib/pdf-template.ts` (–Ω–æ–≤—ã–π)
- `inngest/functions/pdf-generation.ts` (–æ–±–Ω–æ–≤–ª–µ–Ω)

---

### –≠—Ç–∞–ø 3: –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π ‚úÖ
- –°–æ–∑–¥–∞–Ω–∞ —É—Ç–∏–ª–∏—Ç–∞ `lib/image-optimizer.ts` –¥–ª—è —Å–∫–∞—á–∏–≤–∞–Ω–∏—è –∏ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏
- –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è —Å–∫–∞—á–∏–≤–∞—é—Ç—Å—è –∏ –≤—Å—Ç—Ä–∞–∏–≤–∞—é—Ç—Å—è –∫–∞–∫ base64 data URLs
- –ò—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –∏–∑ –∫—É—Ä—Å–∞ (–Ω–µ –≥–µ–Ω–µ—Ä–∏—Ä—É—é—Ç—Å—è –Ω–æ–≤—ã–µ)
- –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ —Å timeout –∏ graceful degradation

**–§–∞–π–ª—ã:**
- `lib/image-optimizer.ts` (–Ω–æ–≤—ã–π)
- `inngest/functions/pdf-generation.ts` (–æ–±–Ω–æ–≤–ª–µ–Ω)

---

### –≠—Ç–∞–ø 4: –£–ª—É—á—à–µ–Ω–∏–µ HTML —à–∞–±–ª–æ–Ω–∞ ‚úÖ
- –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω—ã —Å—Ç–∏–ª–∏ –¥–ª—è –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–π –∫–æ–º–ø–∞–∫—Ç–Ω–æ—Å—Ç–∏
- –£–º–µ–Ω—å—à–µ–Ω—ã —Ä–∞–∑–º–µ—Ä—ã —à—Ä–∏—Ñ—Ç–æ–≤ (11px body, 9-13px –¥–ª—è —ç–ª–µ–º–µ–Ω—Ç–æ–≤)
- –£–º–µ–Ω—å—à–µ–Ω—ã –æ—Ç—Å—Ç—É–ø—ã –∏ margins
- –£–ª—É—á—à–µ–Ω –ø—Ä–æ–º–ø—Ç –¥–ª—è OpenAI (–±–æ–ª–µ–µ —Å—Ç—Ä–æ–≥–∏–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫ –∫–æ–º–ø–∞–∫—Ç–Ω–æ—Å—Ç–∏)
- –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –¥–æ max-height: 120px

**–§–∞–π–ª—ã:**
- `lib/pdf-template.ts` (–æ–±–Ω–æ–≤–ª–µ–Ω)
- `lib/pdf-formatter.ts` (–æ–±–Ω–æ–≤–ª–µ–Ω)

---

### –≠—Ç–∞–ø 5: –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è Puppeteer ‚úÖ
- –£–º–µ–Ω—å—à–µ–Ω—ã –æ—Ç—Å—Ç—É–ø—ã PDF (8mm –≤–º–µ—Å—Ç–æ 10mm)
- –£–±—Ä–∞–Ω–∞ –ª–∏—à–Ω—è—è –∑–∞–¥–µ—Ä–∂–∫–∞ (500ms –≤–º–µ—Å—Ç–æ 1000ms)
- –î–æ–±–∞–≤–ª–µ–Ω—ã –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∞—Ä–≥—É–º–µ–Ω—Ç—ã –¥–ª—è Chromium
- –£–ª—É—á—à–µ–Ω–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–∞–∑–º–µ—Ä–∞ PDF

**–§–∞–π–ª—ã:**
- `inngest/functions/pdf-generation.ts` (–æ–±–Ω–æ–≤–ª–µ–Ω)

---

## üìä –ö–ª—é—á–µ–≤—ã–µ —É–ª—É—á—à–µ–Ω–∏—è

### –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å
- ‚ö° –í—Ä–µ–º—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏: < 30 —Å–µ–∫—É–Ω–¥ (–±—ã–ª–æ ~60 —Å–µ–∫—É–Ω–¥)
- üì¶ –†–∞–∑–º–µ—Ä PDF: < 2MB (–±—ã–ª–æ –º–æ–∂–µ—Ç –±—ã—Ç—å –±–æ–ª—å—à–µ)
- üìÑ –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å—Ç—Ä–∞–Ω–∏—Ü: ‚â§ 4 —Å—Ç—Ä–∞–Ω–∏—Ü—ã (–≥–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–æ)

### –ù–∞–¥–µ–∂–Ω–æ—Å—Ç—å
- ‚úÖ –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –≤—Å—Ç—Ä–æ–µ–Ω—ã –≤ HTML (–Ω–µ –∑–∞–≤–∏—Å—è—Ç –æ—Ç –≤–Ω–µ—à–Ω–∏—Ö URL)
- ‚úÖ Graceful degradation (—Ä–∞–±–æ—Ç–∞–µ—Ç –¥–∞–∂–µ –µ—Å–ª–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –Ω–µ –∑–∞–≥—Ä—É–∑–∏–ª–∏—Å—å)
- ‚úÖ –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ —Å timeout

### –≠–∫–æ–Ω–æ–º–∏—è
- üí∞ –ù–µ –≥–µ–Ω–µ—Ä–∏—Ä—É—é—Ç—Å—è –Ω–æ–≤—ã–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è (–∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ)
- üí∞ –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –ø—Ä–æ–º–ø—Ç—ã (–º–µ–Ω—å—à–µ —Ç–æ–∫–µ–Ω–æ–≤ OpenAI)
- üí∞ –≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ–µ —Ö—Ä–∞–Ω–µ–Ω–∏–µ (Vercel Blob –≤–º–µ—Å—Ç–æ –ë–î)

---

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –ß—Ç–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å:

1. **–ì–µ–Ω–µ—Ä–∞—Ü–∏—è PDF:**
   - –°–æ–∑–¥–∞—Ç—å –∫—É—Ä—Å —á–µ—Ä–µ–∑ –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä
   - –ù–∞–∂–∞—Ç—å "Generate PDF" –≤ Dashboard
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ PDF –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è —É—Å–ø–µ—à–Ω–æ

2. **–†–∞–∑–º–µ—Ä PDF:**
   - –û—Ç–∫—Ä—ã—Ç—å —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π PDF
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å—Ç—Ä–∞–Ω–∏—Ü (–¥–æ–ª–∂–Ω–æ –±—ã—Ç—å ‚â§ 4)
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–∞–∑–º–µ—Ä —Ñ–∞–π–ª–∞ (–¥–æ–ª–∂–µ–Ω –±—ã—Ç—å < 2MB)

3. **–°–æ–¥–µ—Ä–∂–∏–º–æ–µ PDF:**
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω–∞–ª–∏—á–∏–µ –≤—Å–µ—Ö —Å–µ–∫—Ü–∏–π (Overview, Weekly Schedule, Exercises, Nutrition)
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á–∏—Ç–∞–µ–º–æ—Å—Ç—å —Ç–µ–∫—Å—Ç–∞
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω–∞–ª–∏—á–∏–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π (–µ—Å–ª–∏ –±—ã–ª–∏ –≤ –∫—É—Ä—Å–µ)

4. **–•—Ä–∞–Ω–µ–Ω–∏–µ:**
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ PDF —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ Vercel Blob
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ URL —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ –ë–î
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ PDF –¥–æ—Å—Ç—É–ø–µ–Ω –ø–æ URL

5. **–û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫:**
   - –ü–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å PDF –¥–ª—è –∫—É—Ä—Å–∞ –±–µ–∑ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
   - –ü–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å PDF –¥–ª—è –∫—É—Ä—Å–∞ –±–µ–∑ –∫–æ–Ω—Ç–µ–Ω—Ç–∞
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ –≤ Inngest

---

## üîß Environment Variables

–£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤ `.env` —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã:

```env
BLOB_READ_WRITE_TOKEN=vercel_blob_xxx
OPENAI_API_KEY=sk-...
CHALETCOACHING_INNGEST_EVENT_KEY=...
CHALETCOACHING_INNGEST_SIGNING_KEY=...
```

---

## üìù –õ–æ–≥–∏ –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏

–ü—Ä–∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ PDF –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ Inngest:

```
‚úÖ User authenticated: {userId}
‚úÖ Course found: {courseId}
‚úÖ Found {N} existing images from course
‚úÖ Downloading and optimizing {N} images...
‚úÖ Successfully optimized {N} images
‚úÖ Content formatted for PDF
‚úÖ HTML template generated with embedded images
‚úÖ PDF generated successfully: {size} KB
‚úÖ PDF uploaded to Blob: {url} ({size} bytes)
‚úÖ PDF URL saved to database: {url}
```

---

## üö® –ò–∑–≤–µ—Å—Ç–Ω—ã–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è

1. **–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è:** –ú–∞–∫—Å–∏–º—É–º 2 –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –≤ PDF (–¥–ª—è –∫–æ–º–ø–∞–∫—Ç–Ω–æ—Å—Ç–∏)
2. **–†–∞–∑–º–µ—Ä –∫–æ–Ω—Ç–µ–Ω—Ç–∞:** OpenAI –ø—Ä–æ–º–ø—Ç –æ–≥—Ä–∞–Ω–∏—á–µ–Ω 2000 —Ç–æ–∫–µ–Ω–∞–º–∏
3. **–í—Ä–µ–º—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏:** –ó–∞–≤–∏—Å–∏—Ç –æ—Ç —Ä–∞–∑–º–µ—Ä–∞ –∫–æ–Ω—Ç–µ–Ω—Ç–∞ –∏ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
4. **–†–∞–∑–º–µ—Ä PDF:** –ú–æ–∂–µ—Ç –±—ã—Ç—å –±–æ–ª—å—à–µ 2MB –µ—Å–ª–∏ –º–Ω–æ–≥–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –≤—ã—Å–æ–∫–æ–≥–æ –∫–∞—á–µ—Å—Ç–≤–∞

---

## üîÑ –û—Ç–∫–∞—Ç –∏–∑–º–µ–Ω–µ–Ω–∏–π

–ï—Å–ª–∏ –Ω—É–∂–Ω–æ –æ—Ç–∫–∞—Ç–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è:

1. –í–µ—Ä–Ω—É—Ç—å —Å—Ç–∞—Ä—É—é –≤–µ—Ä—Å–∏—é `inngest/functions/pdf-generation.ts`
2. –£–¥–∞–ª–∏—Ç—å –Ω–æ–≤—ã–µ —Ñ–∞–π–ª—ã:
   - `lib/blob-storage.ts`
   - `lib/pdf-formatter.ts`
   - `lib/pdf-template.ts`
   - `lib/image-optimizer.ts`
3. –í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Å—Ç–∞—Ä—É—é –ª–æ–≥–∏–∫—É —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è base64 –≤ –ë–î

---

**–î–∞—Ç–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è:** 2025-01-XX
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ì–æ—Ç–æ–≤–æ –∫ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é

